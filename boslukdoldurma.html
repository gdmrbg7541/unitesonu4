<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> ÿ™ŸÖÿ±ŸäŸÜ ŸÖŸÑÿ° ÿßŸÑŸÅÿ±ÿßÿ∫</title>
    <link href="https://fonts.googleapis.com/css2?family=Markazi+Text:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* [MEVCUT CSS STƒ∞LLERƒ∞ BURAYA GELƒ∞R] */
        :root {
            --accent-color: #007bff;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --bg-light: #f8f9fa;
            --font-arabic: 'Markazi Text', 'Tahoma', 'Arial', sans-serif;
        }

        body {
            font-family: var(--font-arabic);
            background-color: #e9ecef;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden;
            font-weight: 400;
        }

        /* --- Ana Etkinlik Alanƒ± (MASA√úST√ú BOYUTLARI KORUNDU) --- */
        .activity-container {
            position: relative;
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            /* Y√ºklediƒüiniz dosyadan aynen alƒ±ndƒ± (MASA√úST√ú) */
            width: 90vw;
            height: calc(90vw * 9 / 16);
            max-height: 90vh;
            max-width: calc(90vh * 16 / 9);
        }

        body.fullscreen .activity-container {
            width: 100vw;
            height: calc(100vw * 9 / 16); 
            max-height: 100vh;
            max-width: calc(100vh * 16 / 9);
            border-radius: 0;
            box-shadow: none;
        }

        .back-button-container {
            grid-area: back;
            display: flex;
            justify-content: flex-end; 
            align-items: center; 
            gap: 10px;           
        }
        .back-button {
            background: #f0f0f0;
            color: #555;
            border: 1px solid #ccc;
            border-radius: 1.5vmin;
            cursor: pointer;
            width: clamp(40px, 8vmin, 55px);
            height: clamp(40px, 8vmin, 55px);
            padding: 0;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .back-button:hover { background: #e0e0e0; }
        .back-button svg {
            width: clamp(24px, 5vmin, 30px);
            height: clamp(24px, 5vmin, 30px);
            fill: currentColor;
        }

        /* --- Ba≈ülƒ±k ve ƒ∞lerleme --- */
        .header {
            padding: 15px 25px;
            border-bottom: 1px solid #dee2e6;
            display: grid;
            grid-template-areas: "progress instruction back"; 
            grid-template-columns: 310px 1fr 310px;
            align-items: center;
            gap: 20px;
        }
        
        #instruction-text { 
            grid-area: instruction;
            text-align: center; 
            font-size: clamp(1.8rem, 2.2vw, 3rem); 
            font-weight: 700;
            color: #555;
        }
        
        .progress-container { 
            grid-area: progress;
            display: flex;
            align-items: center;
            gap: 15px;
            justify-content: flex-start;
            width: 310px;
            direction: ltr; 
        }
        #progress-display {
            font-size: 1.5rem; 
            font-weight: bold;
            color: var(--accent-color);
            flex-shrink: 0;
        }
        .progress-bar-container {
            flex-grow: 1;
            height: 12px;
            background-color: #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }
        #progress-bar {
            height: 100%;
            width: 0%;
            background-color: var(--accent-color);
            transition: width 0.4s ease, background-color 0.4s ease;
        }

        #fullscreen-btn {
            background: #f0f0f0;
            color: #555;
            border: 1px solid #ccc;
            border-radius: 1.5vmin;
            cursor: pointer;
            width: clamp(40px, 8vmin, 55px);
            height: clamp(40px, 8vmin, 55px);
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        #fullscreen-btn:hover { background: #e0e0e0; }
        #fullscreen-btn svg {
            width: clamp(24px, 5vmin, 30px);
            height: clamp(24px, 5vmin, 30px);
            fill: currentColor;
        }
        #fullscreen-btn .icon-open { display: block; }
        #fullscreen-btn .icon-close { display: none; }
        body.fullscreen #fullscreen-btn .icon-open { display: none; }
        body.fullscreen #fullscreen-btn .icon-close { display: block; }

        /* --- Etkinlik Alanƒ± --- */
        .activity-area {
            flex-grow: 1;
            padding: 10px 20px; 
            display: flex;
            flex-direction: column;
            justify-content: flex-start; 
            overflow-y: auto;
            padding-top: 15px; 
        }

        .fill-in-blank-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            height: 100%;
            justify-content: center; 
            padding-bottom: 20px; 
        }
        .question-text {
            /* MASA√úST√ú boyutu korundu */
            font-size: clamp(2.5rem, 5vw, 6rem);
            font-weight: 700;
            color: #212529;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
            line-height: 1.6;
            white-space: normal; 
            text-align: center;
        }
        .answer-input {
            /* MASA√úST√ú boyutu korundu */
            font-size: inherit; 
            font-weight: 700;
            font-family: var(--font-arabic);
            border: 2px solid var(--accent-color);
            border-radius: 8px;
            padding: 0 15px; 
            width: 300px;
            max-width: 80%;
            text-align: center;
            margin: 0 15px;
            min-height: clamp(60px, 10vh, 100px); 
            background: #f8f9fa;
            direction: rtl; 
            color: #333;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        /* --- Klavye Stilleri --- */
        .keyboard-container {
            width: 100%;
            margin-top: 10px;
            direction: rtl; 
            user-select: none;
            padding: 0 10px;
            box-sizing: border-box;
        }
        .key-row {
            display: flex;
            justify-content: center;
            gap: 0.8vw; 
            margin-bottom: 0.8vw;
        }

        .key-container {
            /* MASA√úST√ú boyutu korundu */
            position: relative;
            flex-grow: 1;
            flex-basis: 0;
            max-width: 80px;
            height: clamp(50px, 7vh, 75px);
        }

        .key {
            /* MASA√úST√ú boyutu korundu */
            font-family: var(--font-arabic);
            font-size: clamp(1.4rem, 2vw, 2.5rem);
            font-weight: 700;
            width: 100%;
            height: 100%;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.1s ease;
            border: none;
            position: absolute;
            top: 0; left: 0;
        }
        .key:active { transform: scale(0.95); }
        .key.backspace { font-size: 1.5rem; color: white; }

        /* Uzun Basma Popup */
        .long-press-popup {
            position: absolute;
            bottom: 115%;
            left: 50%;
            transform: translateX(-50%);
            background: #ffffff;
            border: 1px solid #ccc;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            display: none;
            gap: 5px;
            padding: 8px;
            z-index: 1000;
        }
        
        .long-press-popup.show {
            display: flex;
            animation: popIn 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .variant-key {
            /* MASA√úST√ú boyutu korundu */
            font-family: var(--font-arabic);
            font-size: clamp(1.4rem, 2vw, 2.5rem);
            font-weight: bold;
            width: clamp(50px, 7vh, 75px);
            height: clamp(50px, 7vh, 75px);
            display: flex;
            align-items: center;
            justify-content: center;
            background: #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s;
            color: #333;
            box-shadow: 0 4px 5px rgba(0,0,0,0.1);
        }
        .variant-key:hover { background: var(--accent-color); color: white; }

        @keyframes popIn {
            from { opacity: 0; transform: translateX(-50%) scale(0.5); }
            to { opacity: 1; transform: translateX(-50%) scale(1); }
        }

        /* --- Kontrol Butonlarƒ± --- */
        #check-scramble-btn, #reset-scramble-btn {
            padding: 15px 30px;
            font-size: 2rem; 
            font-family: var(--font-arabic);
            font-weight: 700;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s, opacity 0.2s;
            margin: 5px;
        }
        #check-scramble-btn { background-color: var(--success-color); color: white; }
        #reset-scramble-btn { background-color: var(--danger-color); color: white; }
        
        #check-scramble-btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            opacity: 0.6;
            transform: none;
        }

        .scramble-controls {
            display: flex;
            justify-content: center;
            margin-top: 10px;
        }

        /* --- Geri Bildirim --- */
        .feedback-overlay {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            justify-content: center; align-items: center;
            font-size: 10rem;
            z-index: 200;
            visibility: hidden; opacity: 0;
            transition: opacity 0.3s ease;
        }
        .feedback-overlay.show { visibility: visible; opacity: 1; }
        .feedback-overlay .correct { color: var(--success-color); }
        .feedback-overlay .incorrect { color: var(--danger-color); }
        
        #feedback-details {
            display: none; 
            flex-direction: column; align-items: center;
            position: absolute; bottom: 5%; width: 100%;
        }
        #feedback-correct-answer {
            font-size: 4rem; 
            font-weight: 700; color: #333;
            background: #fff; padding: 10px 20px;
            border-radius: 10px; border: 2px solid #ccc;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            max-width: 90%;
            text-align: center;
        }
        #feedback-ok-button {
            font-size: 2.5rem; font-weight: 700; color: white;
            background-color: var(--success-color);
            border: none; border-radius: 50%;
            width: 70px; height: 70px;
            cursor: pointer; margin-top: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        
        /* --- Biti≈ü --- */
        #finish-screen {
            text-align: center; font-weight: 700; color: var(--accent-color);
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            height: 100%;
        }
        #finish-screen p { font-size: 3.5rem; margin: 10px 0; }
        .score-display {
            display: flex; gap: 30px; font-size: 2.8rem; 
            margin: 10px 0; direction: ltr;
        }
        .score-item { font-weight: 700; }
        .score-correct { color: var(--success-color); }
        .score-incorrect { color: var(--danger-color); }
        #replay-button {
            font-size: 4.5rem; background: none; border: none;
            cursor: pointer; padding: 10px; border-radius: 50%;
            transition: transform 0.2s ease, background-color 0.2s ease;
        }
        #replay-button:hover { transform: rotate(-90deg); background-color: #f0f0f0; }
        
        /* ------------------------------------------------------------------ */
        /* --- YATAY MOD UYARISI STƒ∞LLERƒ∞ --- */
        /* ------------------------------------------------------------------ */
        
        #rotate-message {
            position: fixed;
            top: 0; left: 0;
            width: 100vw; height: 100vh;
            background-color: #343a40; 
            color: white;
            display: none; /* Ba≈ülangƒ±√ßta gizli */
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
            z-index: 5000;
            font-family: var(--font-arabic);
        }

        #rotate-message p {
            font-size: clamp(1.5rem, 4vw, 3rem);
            margin: 15px 0;
            line-height: 1.5;
            font-weight: 700;
        }

        .phone-animation {
            background: var(--accent-color);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            margin-bottom: 30px;
            animation: rotate-phone 2s infinite ease-in-out;
        }

        @keyframes rotate-phone {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(90deg); }
        }

        /* YALNIZCA Dƒ∞KEY (PORTRAIT) MOD KONTROL√ú */
        @media only screen and (orientation: portrait) {
            #rotate-message { display: flex; } /* Dikeyde uyarƒ±yƒ± g√∂ster */
            .activity-container { display: none; } /* Dikeyde aktiviteyi gizle */
        }

        /* ------------------------------------------------------------------ */
        /* --- MOBƒ∞L YATAY (LANDSCAPE) MOD K√ú√á√úLTME YAMASI --- */
        /* (Ekran y√ºksekliƒüi 900px ve altƒ± olan yatay cihazlar i√ßin) */
        /* ------------------------------------------------------------------ */
        @media only screen and (max-height: 900px) and (orientation: landscape) {
            
            /* Ba≈ülƒ±k Alanƒ± ve Elementleri */
            .header {
                padding: 8px 15px;
                gap: 10px;
                grid-template-columns: 250px 1fr 250px; /* Progress bar ve back butonu alanƒ± daraltƒ±ldƒ± */
            }
            #instruction-text {
                font-size: clamp(1.5rem, 1.8vw, 2.5rem); 
            }
            .progress-container { width: 250px; }
            #progress-display { font-size: 1.2rem; }
            .back-button, #fullscreen-btn {
                width: clamp(35px, 6vmin, 45px);
                height: clamp(35px, 6vmin, 45px);
            }
            .back-button svg, #fullscreen-btn svg {
                 width: clamp(20px, 4vmin, 25px);
                 height: clamp(20px, 4vmin, 25px);
            }


            .answer-input {
                width: 250px; /* Daha dar input */
                min-height: clamp(50px, 8vh, 80px); /* Daha kƒ±sa input */
                padding: 0 10px;
                margin: 0 10px;
            }
            
            /* Klavye K√º√ß√ºltme */
            .keyboard-container {
                padding: 0 5px;
                margin-top: 5px;
            }
            .key-row {
                gap: 0.5vw;
                margin-bottom: 0.5vw;
            }
            .key-container {
                max-width: 65px;
                height: clamp(40px, 6vh, 60px); 
            }
            .key, .variant-key {
                font-size: clamp(1.2rem, 1.7vw, 2.2rem); 
            }
            .key.backspace { font-size: 1rem; }

            /* Kontrol Butonlarƒ± */
            #check-scramble-btn, #reset-scramble-btn {
                padding: 10px 20px;
                font-size: 1.5rem;
            }
            
            /* Geri Bildirim */
            #feedback-correct-answer { font-size: 3rem; }
            #feedback-ok-button { width: 55px; height: 55px; font-size: 2rem; margin-top: 15px;}
        }
    </style>
</head>
<body>

    <div class="activity-container">
        
        <div class="header">
            <div class="progress-container">
                <div id="progress-display">...</div> 
                <div class="progress-bar-container">
                    <div id="progress-bar"></div>
                </div>
            </div>
            
            <div id="instruction-text">...</div>

            <div class="back-button-container">
                <button id="fullscreen-btn">
                    <svg class="icon-open" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M5 10h2V7h3V5H5v5zM14 5v2h3v3h2V5h-5zM5 19v-5h2v3h3v2H5zM14 19v-2h3v-3h2v5h-5z"/>
                    </svg>
                    <svg class="icon-close" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/>
                    </svg>
                </button>

                <a href="index.html" class="back-button">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                    </svg>
                </a>
            </div>
        </div>

        <div class="activity-area" id="activity-area"></div>

        <div class="feedback-overlay" id="feedback-overlay">
            <span id="feedback-icon"></span>
            <div id="feedback-details">
                <div id="feedback-correct-answer"></div>
                <button id="feedback-ok-button">‚úî</button>
            </div>
        </div>

    </div>
    
    <div id="rotate-message">
        <div class="phone-animation">
            <svg viewBox="0 0 24 24" fill="#ffffff" width="60" height="60">
                <path d="M17 1H7C5.9 1 5 1.9 5 3v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-2-2-2zm-2 20H9v-1h6v1zm2-3H7V6h10v12z" />
            </svg>
        </div>
        
    </div>

    <script>
        // --- KLAVYE TASARIMI ---
        const colorMap = {
            'ÿ®':'#a0c4ff','ÿ™':'#a0c4ff','ÿ´':'#a0c4ff','ŸÜ':'#a0c4ff','Ÿä':'#a0c4ff',
            'ÿ¨':'#caffbf','ÿ≠':'#caffbf','ÿÆ':'#caffbf',
            'ÿØ':'#fdffb6','ÿ∞':'#fdffb6',
            'ÿ±':'#ffd6a5','ÿ≤':'#ffd6a5',
            'ÿ≥':'#ffadad','ÿ¥':'#ffadad',
            'ÿµ':'#bdb2ff','ÿ∂':'#bdb2ff',
            'ÿ∑':'#9bf6ff','ÿ∏':'#9bf6ff',
            'ÿπ':'#ffc6ff','ÿ∫':'#ffc6ff',
            'ŸÅ':'#b9f6ca','ŸÇ':'#b9f6ca',
            'Ÿá':'#b3e5fc','ÿ©':'#b3e5fc',
            'ÿ°':'#ffccbc','ÿ§':'#ffccbc','ÿ¶':'#ffccbc',
            'ÿß':'#e0e0e0','ŸÑ':'#e0e0e0',
            'ŸÉ':'#d1c4e9',
            'm':'#f8bbd0', 
            'ŸÖ':'#f8bbd0',
            'Ÿà':'#c5cae9'
        };
        const defaultColor='#FFFFFF';
        const backspaceBg = '#E53935';
        
        // --- UZUN BASMA VERƒ∞Sƒ∞ ---
        const longPressData = {
            'ÿß': ['ÿ£', 'ÿ•', 'ÿ¢'], 
            'Ÿä': ['Ÿâ', 'ÿ¶'] // y harfi basƒ±lƒ± tutulunca hala Ÿâ ve ÿ¶ √ßƒ±kabilir, bu kullanƒ±cƒ± deneyimi i√ßin korundu.
        };
        
        function getDarkerColor(hex) {
            if (!hex || hex === '#FFFFFF') hex = '#CCCCCC'; 
            if (hex.length === 4) { 
                hex = `#${hex[1]}${hex[1]}${hex[2]}${hex[2]}${hex[3]}${hex[3]}`;
            }
            let r = parseInt(hex.slice(1, 3), 16);
            let g = parseInt(hex.slice(3, 5), 16);
            let b = parseInt(hex.slice(5, 7), 16);
            r = Math.floor(r * 0.85); 
            g = Math.floor(g * 0.85);
            b = Math.floor(b * 0.85);
            return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;
        }
        
        const backspaceShadow = getDarkerColor(backspaceBg);
        
        const keyRows = [
            ["ÿØ","ÿ¨","ÿ≠","ÿÆ","Ÿá","ÿπ","ÿ∫","ŸÅ","ŸÇ","ÿ´","ÿµ","ÿ∂"],
            ["ÿ∑","ŸÉ","ŸÖ","ŸÜ","ÿ™","ÿß","ŸÑ","ÿ®","Ÿä","ÿ≥","ÿ¥","ÿ∞"],
            ["Backspace", "ÿ∏","ÿ≤","Ÿà","ÿ©","Ÿâ","ÿ±","ÿ§","ÿ°","ÿ¶"] 
        ];

       // --- Etkinlik Verileri ---
        const activitiesData = [
    
    
    // 1. C√ºmle: Sabah erkenden uyanƒ±rƒ±m.
    { 
        pre: "ŸÅŸä ÿßŸÑÿ≥ŸéŸëŸÜŸéÿ©", 
        post: "ŸÅŸèÿµŸàŸÑ", 
        a: "ÿ£Ÿéÿ±Ÿíÿ®ŸéÿπŸéÿ©", 
        hint: "Sayƒ± (D√∂rt)" 
    },
    { 
        pre: "ŸÅŸä ŸÅŸéÿµŸíŸÑ ÿßŸÑÿµŸéŸëŸäŸíŸÅÿå ÿßŸÑÿ¨ŸéŸàŸë", 
        post: "", 
        a: ["ÿ≠Ÿéÿßÿ±Ÿë", "ŸÖŸèÿ¥ŸíŸÖŸêÿ≥"], 
        hint: "Sƒ±fat (Sƒ±cak veya G√ºne≈üli)" 
    },
    
   { 
        pre: "ŸÅŸä ŸÅŸéÿµŸíŸÑ ÿßŸÑÿÆŸéÿ±ŸäŸÅ ŸäŸéŸÜŸíÿ≤ŸêŸÑŸè", 
        post: "", 
        a: "ÿßŸÑŸÖŸéÿ∑Ÿéÿ±", 
        hint: "ƒ∞sim (Yaƒümur)" 
    },
    { 
        pre: "ŸÅŸä ŸÅŸéÿµŸíŸÑ ÿßŸÑÿ¥ŸêŸëÿ™ÿßÿ° ŸäŸéÿ≥ŸíŸÇŸèÿ∑Ÿè", 
        post: "", 
        a: "ÿßŸÑÿ´ŸéŸëŸÑŸíÿ¨", 
        hint: "ƒ∞sim (Kar)" 
    },
    
    { 
        pre: "ŸÅŸä", 
        post: "ÿßŸêÿ´ŸíŸÜÿß ÿπŸéÿ¥Ÿéÿ± ÿ¥ŸéŸáŸíÿ±Ÿãÿß", 
        a: "ÿßŸÑÿ≥ŸéŸëŸÜŸéÿ©", 
        hint: "ƒ∞sim (Yƒ±l)" 
    },
    { 
        pre: "ŸÅŸä ÿßŸÑÿ£Ÿèÿ≥Ÿíÿ®Ÿàÿπ", 
        post: "ÿ£ŸéŸäŸëÿßŸÖ", 
        a: "ÿ≥Ÿéÿ®ŸíÿπŸéÿ©", 
        hint: "Sayƒ± (Yedi)" 
    },
    { 
        pre: "ŸáŸèŸà ŸäŸéŸÑŸíÿ®Ÿéÿ≥Ÿè ÿßŸÑŸÖŸêÿπŸíÿ∑ŸéŸÅ ŸÅŸä ŸÅŸéÿµŸíŸÑ", 
        post: "", 
        a: "ÿßŸÑÿ¥ŸëŸêÿ™ÿßÿ°", 
        hint: "ƒ∞sim (Kƒ±≈ü)" 
    },
    { 
        pre: "ÿ™Ÿéÿ™Ÿéÿ≥ÿßŸÇŸéÿ∑Ÿè", 
        post: "ÿßŸÑÿ¥ŸéŸëÿ¨Ÿéÿ± ŸÅŸä ŸÅŸéÿµŸíŸÑ ÿßŸÑÿÆŸéÿ±ŸäŸÅ", 
        a: "ÿ£ŸéŸàŸíÿ±ÿßŸÇ", 
        hint: "ƒ∞sim (Yapraklar)" 
    },
    { 
        pre: "ÿ™ŸéŸÑŸíÿ®Ÿéÿ≥Ÿè", 
        post: "ÿπŸêŸÜŸíÿØŸéŸÖÿß ÿ™Ÿéÿ¥ŸíÿπŸèÿ±Ÿè ŸäŸéÿØÿßŸÉ ÿ®ŸêÿßŸÑÿ®Ÿéÿ±ŸíÿØ", 
        a: "ŸÇŸèŸÅŸëÿßÿ≤", 
        hint: "ƒ∞sim (Eldiven)" 
    },
   { 
        pre: "ÿ¢ÿÆŸèÿ∞Ÿè ŸÖŸéÿπŸä", 
        post: "ŸÅŸä ÿßŸÑŸäŸéŸàŸíŸÖ ÿßŸÑŸÖŸèŸÖŸíÿ∑Ÿêÿ±", 
        a: "ÿßŸÑŸÖŸêÿ∏ŸéŸÑŸéŸëÿ©", 
        hint: "ƒ∞sim (≈ûemsiye)" 
    },
   { 
        pre: "ŸÑŸéŸàŸí", 
        post: "ÿå ÿ£Ÿèÿ±ŸäÿØŸè ŸÉŸäŸÑŸà ŸÖŸêŸÜ ÿßŸÑÿ≥ŸèŸëŸÉŸéŸëÿ±", 
        a: "ÿ≥ŸéŸÖŸéÿ≠Ÿíÿ™", 
        hint: "ƒ∞fade (L√ºtfen/M√ºsaadenle)" 
    },
    { 
        pre: "ŸáŸéŸÑŸí ÿ£ŸéŸÜŸíÿ™Ÿé", 
        post: "ÿ¥ŸéŸäŸíÿ¶Ÿãÿß ÿ¢ÿÆŸéÿ±ÿü", 
        a: "ÿ™Ÿèÿ±ŸäÿØŸè", 
        hint: "Fiil (ƒ∞stiyorsun)" 
    },
    { 
        pre: "ŸÑŸéŸàŸíŸÜ ÿßŸÑŸÇŸéŸÖŸäÿµ üü°", 
        post: "", 
        a: "ÿ£ŸéÿµŸíŸÅŸéÿ±", 
        hint: "Sƒ±fat (Sarƒ±)" 
    },
    
    { 
        pre: "ŸÑŸéŸàŸíŸÜ ÿßŸÑŸÅŸèÿ≥Ÿíÿ™ÿßŸÜ üü§", 
        post: "", 
        a: "ÿ®ŸèŸÜŸëŸêŸäŸë", 
        hint: "Sƒ±fat (kahverengi)" 
    },
    { 
        pre: "ŸÑŸéŸàŸíŸÜ ÿßŸÑŸÇŸèÿ®ŸëŸéÿπŸéÿ© üîµ", 
        post: "", 
        a: "ÿ£Ÿéÿ≤Ÿíÿ±ŸéŸÇ", 
        hint: "Sƒ±fat (Mavi)" 
    },
    { 
        pre: "", 
        post: "ÿ≠ŸéŸÑŸäŸÖŸéÿ© ÿßŸÑÿ¥ŸëÿßŸä ŸàŸéÿßŸÑŸÇŸéŸáŸíŸàŸéÿ©", 
        a: ["ÿ™Ÿéÿ¥Ÿíÿ±Ÿéÿ®Ÿè", "ÿ¥Ÿéÿ±Ÿêÿ®Ÿéÿ™Ÿí"], 
        hint: "Fiil (ƒ∞√ßiyor veya ƒ∞√ßti)" 
    },
    { 
        pre: "ŸÖŸéŸÜŸí ÿ∫Ÿéÿ¥ŸéŸëŸÜÿß", 
        post: "ŸÖŸêŸÜŸëÿß", 
        a: "ŸÅŸéŸÑŸéŸäŸíÿ≥Ÿé", 
        hint: "ƒ∞fade (Deƒüildir/Yoktur)" 
    },
    { 
        pre: "ÿ®ŸêŸÖÿßÿ∞ÿß ÿ™Ÿéÿ¥ŸíÿπŸèÿ±Ÿè ŸÅŸä", 
        post: "ÿßŸÑÿµŸéŸëŸäŸíŸÅÿü", 
        a: "ŸÅŸéÿµŸíŸÑ", 
        hint: "ƒ∞sim (Mevsim)" 
    },

    { 
        pre: "", 
        post: "ŸäŸéŸàŸíŸÖŸãÿß ŸÅŸä ÿßŸÑÿ£Ÿèÿ≥Ÿíÿ®Ÿàÿπÿü", 
        a: "ŸÉŸéŸÖ", 
        hint: "Soru Edatƒ± (Ka√ß)" 
    },
    { 
        pre: "ŸÑŸéŸàŸíŸÜ ÿßŸÑÿ≥ŸëŸéŸäŸëÿßÿ±Ÿéÿ© üî¥", 
        post: "", 
        a: "ÿ£Ÿéÿ≠ŸíŸÖŸéÿ±", 
        hint: "Sƒ±fat (Kƒ±rmƒ±zƒ±)" 
    },
    
];

        // --- Gerekli Elementler ---
        const activityArea = document.getElementById('activity-area');
        const instructionText = document.getElementById('instruction-text');
        const progressDisplay = document.getElementById('progress-display');
        const progressBar = document.getElementById('progress-bar');
        const feedbackOverlay = document.getElementById('feedback-overlay');
        const feedbackIcon = document.getElementById('feedback-icon');
        const feedbackDetails = document.getElementById('feedback-details');
        const feedbackCorrectAnswer = document.getElementById('feedback-correct-answer');
        const feedbackOkButton = document.getElementById('feedback-ok-button');
        const fullscreenButton = document.getElementById('fullscreen-btn');

        // --- Ses ---
        let audioCtx = null;
        function initAudioContext() {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }
        function playSound(type) {
            if (!audioCtx) return; 
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            oscillator.type = 'sine';
            const now = audioCtx.currentTime;

            if (type === 'touch') {
                oscillator.frequency.setValueAtTime(200, now);
                gainNode.gain.setValueAtTime(0.1, now);
                gainNode.gain.exponentialRampToValueAtTime(0.0001, now + 0.1);
                oscillator.start(now);
                oscillator.stop(now + 0.1);
            } else if (type === 'correct') {
                oscillator.frequency.setValueAtTime(440, now);
                oscillator.frequency.linearRampToValueAtTime(880, now + 0.2);
                gainNode.gain.setValueAtTime(0.15, now);
                gainNode.gain.exponentialRampToValueAtTime(0.0001, now + 0.2);
                oscillator.start(now);
                oscillator.stop(now + 0.2);
            } else if (type === 'incorrect') {
                oscillator.frequency.setValueAtTime(300, now);
                oscillator.frequency.linearRampToValueAtTime(150, now + 0.3);
                gainNode.gain.setValueAtTime(0.15, now);
                gainNode.gain.exponentialRampToValueAtTime(0.0001, now + 0.3);
                oscillator.start(now);
                oscillator.stop(now + 0.3);
            }
        }
        document.body.addEventListener('click', () => initAudioContext(), { once: true });

        // --- Oyun Durum Deƒüi≈ükenleri ---
        let allActivitiesData = [];     
        let activityQueue = [];         
        let currentActivityIndex = 0;   
        let grandTotalActivities = 0;   
        let currentRound = 0;           
        const questionsPerRound = 10;   
        let totalRounds = 0;            
        let totalQuestionsInGame = 0;   
        let scoreCorrect = 0;      
        let scoreIncorrect = 0; 

        // --- Tam Ekran ---
        function toggleFullScreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                if (document.exitFullscreen) document.exitFullscreen();
            }
        }
        function checkFullScreen() {
             if (document.fullscreenElement) document.body.classList.add('fullscreen');
             else document.body.classList.remove('fullscreen');
        }
        if(fullscreenButton) fullscreenButton.addEventListener('click', toggleFullScreen);
        document.addEventListener('fullscreenchange', checkFullScreen);

        // --- Yardƒ±mcƒ± Fonksiyonlar ---
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        
        // **********************************************
        // *** G√úNCELLENEN NORMALƒ∞ZASYON FONKSƒ∞YONU ***
        // *** ARTIK Y VE MAKSURA ARASINDA SADELE≈ûTƒ∞RME YAPILMAYACAK ***
        // **********************************************
        function normalizeForCheck(text) {
            if (!text) return "";
            
            // 1. Hareke ve Tanvinleri Kaldƒ±r
            let newText = text.replace(/[\u064B-\u065F]/g, ""); 
            
            // 2. Maksura (Ÿâ) harfini (Ÿä) ile deƒüi≈ütiren satƒ±r KALDIRILDI.
            // newText = newText.replace(/[Ÿâ]/g, "Ÿä"); 
            
            // 3. Elif varyantlarƒ±nƒ± sadele≈ütiren satƒ±r ZATEN √ñNCEKƒ∞ ƒ∞STEKTE KALDIRILMI≈ûTI.
            
            return newText.trim(); 
        }

        function adjustFontSize(element) {
            element.style.fontSize = '';
            element.style.whiteSpace = 'normal';
            const baseFontSize = parseFloat(window.getComputedStyle(element).fontSize);
            const currentHeight = element.clientHeight;
            if (currentHeight > baseFontSize * 1.7) { 
                element.style.whiteSpace = 'nowrap';
                let currentFontSize = baseFontSize;
                while (element.scrollWidth > element.clientWidth && currentFontSize > 16) {
                    currentFontSize -= 1; 
                    element.style.fontSize = currentFontSize + 'px';
                }
            }
        }

        // --- ETKƒ∞NLƒ∞K Y√úKLEME ---
        function loadActivity() {
            activityArea.innerHTML = '';
            updateProgress(); 
            const activityData = activityQueue[currentActivityIndex]; 
            instructionText.textContent = "ÿßŸêŸÖŸíŸÑŸéÿ£ ÿßŸÑŸÅŸéÿ±ÿßÿ∫ ÿ®ŸêÿßŸÑŸÉŸéŸÑŸêŸÖŸéÿ© ÿßŸÑŸÖŸèŸÜÿßÿ≥Ÿêÿ®Ÿéÿ©.";
            buildFillInTheBlank(activityData);
        }
        
        function buildFillInTheBlank(data) {
            const container = document.createElement('div');
            container.className = 'fill-in-blank-container';

            const questionText = document.createElement('div');
            questionText.className = 'question-text';
            
            const preText = document.createElement('span');
            preText.textContent = data.pre;
            
            const answerInput = document.createElement('div');
            answerInput.id = 'answer-input';
            answerInput.className = 'answer-input';
            
            let postContent = data.post; 
            if (postContent === "") postContent = "."; 
            else {
                const trimmedPost = postContent.trim();
                const lastChar = trimmedPost.charAt(trimmedPost.length - 1);
                if (['ÿü','?','!'].includes(lastChar)) postContent = " " + postContent;
                else postContent = " " + postContent + "."; 
            }
            const postText = document.createElement('span');
            postText.textContent = postContent;
            
            questionText.appendChild(preText);
            questionText.appendChild(answerInput);
            questionText.appendChild(postText);
            
            container.appendChild(questionText);
            adjustFontSize(questionText);

            // Klavyeyi ekle
            container.appendChild(buildKeyboard()); 
            
            const controls = document.createElement('div');
            controls.className = 'scramble-controls'; 
            
            const checkButton = document.createElement('button');
            checkButton.id = 'check-scramble-btn';
            checkButton.textContent = '‚úî ÿ™Ÿéÿ≠ŸéŸÇŸéŸëŸÇŸí';
            checkButton.disabled = true; // BA≈ûLANGI√áTA DEVRE DI≈ûI
            checkButton.onclick = () => {
                playSound('touch');
                checkFillInBlankAnswer(data.a); 
            };
            
            const resetButton = document.createElement('button');
            resetButton.id = 'reset-scramble-btn'; 
            resetButton.textContent = 'üîÑ ÿßŸêŸÖŸíÿ≥Ÿéÿ≠Ÿí'; 
            resetButton.onclick = () => {
                playSound('touch');
                const input = document.getElementById('answer-input');
                if(input) input.textContent = ''; 
                
                // Resetleyince doƒürulama butonunu tekrar kapat
                const checkBtn = document.getElementById('check-scramble-btn');
                if (checkBtn) checkBtn.disabled = true;
            };

            controls.appendChild(checkButton);
            controls.appendChild(resetButton);
            
            container.appendChild(controls);
            activityArea.appendChild(container);
        }

        // --- KLAVYE OLU≈ûTURUCU (Uzun Basma √ñzellikli) ---
        function buildKeyboard() {
            const keyboardContainer = document.createElement('div');
            keyboardContainer.className = 'keyboard-container';

            keyRows.forEach(row => {
                const keyRow = document.createElement('div');
                keyRow.className = 'key-row';
                
                row.forEach(keyText => {
                    const keyContainer = document.createElement('div');
                    keyContainer.className = 'key-container';
                    if (keyText === 'Backspace') keyContainer.style.maxWidth = '110px';

                    const key = document.createElement('div');
                    key.className = 'key';
                    key.textContent = keyText;
                    
                    if (keyText === 'Backspace') {
                        key.classList.add('backspace');
                        key.innerHTML = '‚å´'; 
                        key.style.backgroundColor = backspaceBg;
                        key.style.boxShadow = `0 4px ${backspaceShadow}`;
                    } else {
                        const keyChar = keyText[0]; 
                        const color = colorMap[keyChar] || defaultColor;
                        key.style.backgroundColor = color;
                        key.style.boxShadow = `0 4px ${getDarkerColor(color)}`;
                    }

                    let pressTimer;
                    let isLongPress = false;

                    const startPress = (e) => {
                        e.preventDefault(); 
                        isLongPress = false;
                        
                        // Sadece 'ÿß' ve 'Ÿä' i√ßin uzun basma pop-up'ƒ±nƒ± g√∂ster
                        if (longPressData[keyText]) {
                            pressTimer = setTimeout(() => {
                                isLongPress = true;
                                showVariants(keyText, keyContainer);
                                playSound('touch'); 
                            }, 500); 
                        }
                    };

                    const cancelPress = (e) => {
                        clearTimeout(pressTimer);
                        if (!isLongPress && e.type !== 'mouseleave') {
                            // Eƒüer bir pop-up a√ßƒ±ksa, tu≈üa normal basƒ±≈ü kabul edilmez.
                            if (!document.querySelector('.long-press-popup.show')) {
                                handleKeyInput(keyText);
                            }
                        }
                    };
                    
                    if (keyText === 'Backspace') {
                        key.onclick = () => handleKeyInput('Backspace');
                    } else {
                        key.addEventListener('mousedown', startPress);
                        key.addEventListener('touchstart', startPress, {passive: false});
                        
                        key.addEventListener('mouseup', cancelPress);
                        key.addEventListener('touchend', cancelPress);
                        key.addEventListener('mouseleave', () => clearTimeout(pressTimer));
                    }

                    keyContainer.appendChild(key);
                    keyRow.appendChild(keyContainer);
                });
                keyboardContainer.appendChild(keyRow);
            });
            
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.key-container')) {
                    closeAllPopups();
                }
            });

            return keyboardContainer;
        }

        function showVariants(mainKey, container) {
            closeAllPopups();

            const variants = longPressData[mainKey];
            const popup = document.createElement('div');
            popup.className = 'long-press-popup show';
            
            variants.forEach(char => {
                const vKey = document.createElement('div');
                vKey.className = 'variant-key';
                vKey.textContent = char;
                
                vKey.onclick = (e) => {
                    e.stopPropagation();
                    handleKeyInput(char);
                    closeAllPopups();
                };
                
                popup.appendChild(vKey);
            });
            
            container.appendChild(popup);
        }

        function closeAllPopups() {
            document.querySelectorAll('.long-press-popup').forEach(p => p.remove());
        }

        function handleKeyInput(char) {
            playSound('touch');
            const answerInput = document.getElementById('answer-input');
            if (!answerInput) return;

            if (char === 'Backspace') {
                answerInput.textContent = answerInput.textContent.slice(0, -1);
            } else {
                answerInput.textContent += char;
            }

            // G√úNCELLEME: En az bir karakter varsa butonu aktif et
            const checkBtn = document.getElementById('check-scramble-btn');
            if (checkBtn) {
                checkBtn.disabled = answerInput.textContent.trim().length === 0;
            }
        }

        // --- Cevap Kontrol√º ---
        function checkFillInBlankAnswer(correctAnswer) {
            const answerInput = document.getElementById('answer-input');
            const userAnswer = answerInput.textContent.trim();
            
            // Kullanƒ±cƒ± cevabƒ±nƒ± normalle≈ütir (SADECE HAREKE KALDIRILIR)
            const normalizedUserAnswer = normalizeForCheck(userAnswer); 

            let isCorrect = false;
            const correctAnswers = Array.isArray(correctAnswer) ? correctAnswer : [correctAnswer];

            // Her bir doƒüru cevap i√ßin kontrol yap
            for (const correct of correctAnswers) {
                // Doƒüru cevabƒ± normalle≈ütir (SADECE HAREKE KALDIRILIR)
                const normalizedCorrect = normalizeForCheck(correct); 
                
                // 1. Kesin (Harf farklarƒ± dahil) E≈üle≈üme Kontrol√º
                if (normalizedUserAnswer === normalizedCorrect) { 
                    isCorrect = true; break;
                }
                
                // 2. Kelime ba≈üƒ± Elif-Lam (ÿßŸÑ) Sadele≈ütirmesi (ÿßŸÑ'siz giri≈üi kabul etmek i√ßin)
                if (normalizedCorrect.startsWith("ÿßŸÑ")) {
                    // Elif-Lam'ƒ± kaldƒ±rmadan √∂nce doƒüru cevabƒ±n sadece harekelerden arƒ±ndƒ±rƒ±lmƒ±≈ü halini kullanƒ±rƒ±z.
                    const answerWithoutAl = normalizedCorrect.substring(2); 
                    if (normalizedUserAnswer === answerWithoutAl) { 
                        isCorrect = true; break;
                    }
                }
            }

            showFeedback(isCorrect, correctAnswer); 

            if (isCorrect) scoreCorrect++;
            else scoreIncorrect++;
        }

        function showFeedback(isCorrect, correctAnswer) {
            feedbackOverlay.classList.add('show');
            if (isCorrect) {
                feedbackIcon.textContent = '‚úî';
                feedbackIcon.className = 'correct';
                playSound('correct');
                feedbackDetails.style.display = 'none'; 
                setTimeout(nextActivity, 1200); 
            } else {
                feedbackIcon.textContent = '‚ùå';
                feedbackIcon.className = 'incorrect';
                playSound('incorrect');
                
                const answerToShow = (Array.isArray(correctAnswer) ? correctAnswer.join(' / ') : correctAnswer);
                
                feedbackCorrectAnswer.textContent = `ÿßŸÑÿ¨ŸéŸàÿßÿ® ÿßŸÑÿµŸëŸéÿ≠Ÿäÿ≠: ${answerToShow}`;
                feedbackDetails.style.display = 'flex'; 
                feedbackOkButton.onclick = () => nextActivity(); 
            }
        }

        // --- Oyun Akƒ±≈üƒ± ---
        function nextActivity() {
            feedbackOverlay.classList.remove('show');
            feedbackDetails.style.display = 'none'; 
            currentActivityIndex++; 

            if (currentActivityIndex === grandTotalActivities) {
                if (currentRound === totalRounds) showFinishScreen();
                else showRoundCompleteScreen();
            } else {
                loadActivity();
            }
        }

        function showFinishScreen() {
            activityArea.innerHTML = `
                <div id="finish-screen">
                    <p>ÿ£Ÿéÿ≠Ÿíÿ≥ŸéŸÜŸíÿ™! ŸÑŸéŸÇŸéÿØ ÿ£ŸéŸÉŸíŸÖŸéŸÑŸíÿ™Ÿé ÿ¨ŸéŸÖŸäÿπ ÿßŸÑÿ£ŸéŸÜŸíÿ¥Ÿêÿ∑Ÿéÿ©‚Ä´.‚Ä¨</p>
                    <p style="font-size: 2.5rem; color: #555; margin-bottom: 0;">ÿßŸÑŸÜŸëŸéÿ™Ÿäÿ¨Ÿéÿ© ÿßŸÑŸÜŸëŸêŸáÿßÿ¶ŸêŸäŸëŸéÿ©:</p>
                    <div class="score-display">
                        <span class="score-item score-correct">‚úî ${scoreCorrect}</span>
                        <span class="score-item score-incorrect">‚ùå ${scoreIncorrect}</span>
                    </div>
                    <button id="replay-button" onclick="restartGame()">üîÑ</button>
                </div>
            `;
            instructionText.textContent = ""; 
            progressDisplay.textContent = "";
            progressBar.style.width = '100%';
            progressBar.style.backgroundColor = 'var(--success-color)';
        }

        function showRoundCompleteScreen() {
            activityArea.innerHTML = `
                <div id="finish-screen" style="justify-content: center;">
                    <p>ÿ£Ÿéÿ≠Ÿíÿ≥ŸéŸÜŸíÿ™!</p>
                    <p style="font-size: 2.5rem; color: #555; margin-bottom: 0;">ŸÜŸéÿ™Ÿäÿ¨Ÿéÿ© ŸáŸéÿ∞ŸêŸá ÿßŸÑÿ¨ŸéŸàŸíŸÑŸéÿ©</p>
                    <div class="score-display">
                        <span class="score-item score-correct">‚úî ${scoreCorrect}</span>
                        <span class="score-item score-incorrect">‚ùå ${scoreIncorrect}</span>
                    </div>
                    <button id="check-scramble-btn" onclick="startNextRound()" style="font-size: 1.8rem; margin-top: 20px;">
                        ÿßŸÑÿ™ŸëÿßŸÑŸä
                    </button>
                </div>
            `;
            instructionText.textContent = ""; 
            progressDisplay.textContent = ""; 
            progressBar.style.width = '100%';
            progressBar.style.backgroundColor = 'var(--success-color)';
        }

        function startNextRound() {
            playSound('touch');
            scoreCorrect = 0;
            scoreIncorrect = 0;
            currentRound++;
            currentActivityIndex = 0;
            
            const roundStartIndex = (currentRound - 1) * questionsPerRound;
            const roundEndIndex = Math.min(currentRound * questionsPerRound, totalQuestionsInGame);
            activityQueue = allActivitiesData.slice(roundStartIndex, roundEndIndex);
            grandTotalActivities = activityQueue.length;
            
            progressBar.style.width = '0%';
            progressBar.style.backgroundColor = 'var(--accent-color)';
            loadActivity(); 
        }

        function restartGame() {
            playSound('touch');
            scoreCorrect = 0;
            scoreIncorrect = 0;
            progressBar.style.width = '0%';
            progressBar.style.backgroundColor = 'var(--accent-color)';
            allActivitiesData = shuffle([...activitiesData]);
            totalQuestionsInGame = allActivitiesData.length;
            totalRounds = Math.ceil(totalQuestionsInGame / questionsPerRound);
            currentRound = 0; 
            startNextRound(); 
        }

        function updateProgress() {
            if (grandTotalActivities === 0) {
                 progressDisplay.textContent = `0 / ${grandTotalActivities}`;
                 return;
            }
            const currentTotal = currentActivityIndex + 1;
            const percentage = (currentActivityIndex / grandTotalActivities) * 100;
            progressDisplay.textContent = `${currentTotal} / ${grandTotalActivities}`;
            progressBar.style.width = `${percentage}%`;
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            allActivitiesData = shuffle([...activitiesData]);
            totalQuestionsInGame = allActivitiesData.length;
            totalRounds = Math.ceil(totalQuestionsInGame / questionsPerRound);
            scoreCorrect = 0;
            scoreIncorrect = 0;
            currentRound = 0; 
            startNextRound(); 
            checkFullScreen();
        });

    </script>
</body>
</html>